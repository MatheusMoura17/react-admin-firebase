{"version":3,"file":"index.js","sources":["../src/misc/arrayHelpers.ts","../src/misc/objectFlatten.ts","../src/misc/logger/logger-base.ts","../src/misc/logger/logger.ts","../src/misc/logger/firestore-logger.ts","../src/misc/dispatcher.ts","../src/misc/translate-from-firestore.ts","../src/misc/document-parser.ts","../src/misc/internal.models.ts","../src/misc/pathHelper.ts","../src/misc/translate-to-firestore.ts","../src/providers/database/firebase/FirebaseWrapper.ts","../src/misc/firebase-models.ts","../src/providers/database/ResourceManager.ts","../src/providers/database/FireClient.ts","../src/misc/storage-parser.ts","../src/misc/metadata-parser.ts","../src/providers/lazy-loading/queryCursors.ts","../src/providers/lazy-loading/paramsToQuery.ts","../src/providers/lazy-loading/FirebaseLazyLoadingClient.ts","../src/providers/AuthProvider.ts","../src/misc/status-code-translator.ts","../src/providers/DataProvider.ts","../src/providers/queries/GetList.ts","../src/providers/queries/GetOne.ts","../src/providers/queries/GetMany.ts","../src/providers/queries/GetManyReference.ts","../src/providers/commands/Update.ts","../src/providers/commands/UpdateMany.ts","../src/providers/commands/Create.ts","../src/providers/commands/Delete.ts","../src/providers/commands/Delete.Soft.ts","../src/providers/commands/DeleteMany.ts","../src/providers/commands/DeleteMany.Soft.ts"],"sourcesContent":["import { get, isEmpty } from 'lodash';\nimport { getFieldReferences, SearchObj } from './objectFlatten';\n\nexport function sortArray(\n  data: Array<{}>,\n  field: string,\n  dir: 'asc' | 'desc'\n): void {\n  data.sort((a: {}, b: {}) => {\n    const rawA = get(a, field);\n    const rawB = get(b, field);\n    const isAsc = dir === \"asc\";\n\n    const isNumberField = Number.isFinite(rawA) && Number.isFinite(rawB);\n    if (isNumberField) {\n      return basicSort(rawA, rawB, isAsc);\n    }\n    const isStringField = typeof rawA === 'string' && typeof rawB === 'string';\n    if (isStringField) {\n      const aParsed = rawA.toLowerCase();\n      const bParsed = rawB.toLowerCase();\n      return basicSort(aParsed, bParsed, isAsc);\n    }\n    const isDateField = rawA instanceof Date && rawB instanceof Date;\n    if (isDateField) {\n      return basicSort(rawA, rawB, isAsc);\n    }\n    return basicSort(!!rawA, !!rawB, isAsc);\n  });\n}\n\nfunction basicSort(aValue: any, bValue: any, isAsc: boolean) {\n  if (aValue > bValue) {\n    return isAsc ? 1 : -1;\n  }\n  if (aValue < bValue) {\n    return isAsc ? -1 : 1;\n  }\n  return 0;\n}\n\nexport function filterArray(\n  data: Array<{}>,\n  searchFields?: { [field: string]: string | number | boolean | null }\n): Array<{}> {\n  if (!searchFields || isEmpty(searchFields)) {\n    return data;\n  }\n  const searchObjs: SearchObj[] = [];\n  Object.keys(searchFields).map((fieldName) => {\n    const fieldValue = searchFields[fieldName];\n    const getSubObjects = getFieldReferences(fieldName, fieldValue);\n    searchObjs.push(...getSubObjects);\n  });\n  const filtered = data.filter((row) =>\n    searchObjs.reduce((acc, cur) => {\n      const res = doesRowMatch(row, cur.searchField, cur.searchValue);\n      return res && acc;\n    }, true as boolean)\n  );\n  return filtered;\n}\n\nexport function doesRowMatch(\n  row: {},\n  searchField: string,\n  searchValue: any\n): boolean {\n  const searchThis = get(row, searchField);\n  const bothAreFalsey = !searchThis && !searchValue;\n  if (bothAreFalsey) {\n    return true;\n  }\n  const nothingToSearch = !searchThis;\n  if (nothingToSearch) {\n    return false;\n  }\n  const isStringSearch = typeof searchValue === 'string';\n  if (isStringSearch) {\n    return searchThis\n      .toString()\n      .toLowerCase()\n      .includes(searchValue.toLowerCase());\n  }\n  const isBooleanOrNumber =\n    typeof searchValue === 'boolean' || typeof searchValue === 'number';\n  if (isBooleanOrNumber) {\n    return searchThis === searchValue;\n  }\n  const isArraySearch = Array.isArray(searchValue);\n  if (isArraySearch) {\n    return searchValue.includes(searchThis);\n  }\n  return false;\n}\n","type SearchValues = {} | number | string | boolean | null ;\ntype SearchValue = SearchValues | SearchValue[];\n\nexport interface SearchObj {\n  searchField: string;\n  searchValue: SearchValue;\n}\nexport function getFieldReferences(\n  fieldName: string,\n  value: {} | SearchValue\n): SearchObj[] {\n  const isFalsy = !value;\n  const isSimple = isFalsy ||\n    typeof value === 'string' ||\n    typeof value === 'number' ||\n    typeof value === 'boolean';\n\n  if (isSimple) {\n    return [\n      {\n        searchField: fieldName,\n        searchValue: value as SearchValue,\n      },\n    ];\n  }\n  const tree = {} as Record<string, SearchValue>;\n  tree[fieldName] = value;\n  return objectFlatten(tree);\n}\n\nexport function objectFlatten(tree: {}): SearchObj[] {\n  var leaves: SearchObj[] = [];\n  var recursivelyWalk = function (obj: any, path: string | null) {\n    path = path || \"\";\n    for (var key in obj) {\n      if (obj.hasOwnProperty(key)) {\n        const objVal = obj && obj[key];\n        const currentPath = !!path ? path + \".\" + key : key;\n        const isWalkable =\n          typeof objVal === 'object' || objVal instanceof Array;\n        if (isWalkable) {\n          recursivelyWalk(objVal, currentPath);\n        } else {\n          leaves.push({ searchField: currentPath, searchValue: objVal });\n        }\n      }\n    }\n  };\n  recursivelyWalk(tree, null);\n  return leaves;\n}\n","type LogFn = (...args: any) => void;\n\nexport const LogNoOp: LogFn = (...args: any) => null;\n\nexport class LoggerBase {\n  constructor(private title: string, private cacheEnabledKey: string) {}\n\n  private isEnabled() {\n    return !!localStorage.getItem(this.cacheEnabledKey);\n  }\n\n  SetEnabled(isEnabled: boolean) {\n    if (isEnabled) {\n      localStorage.setItem(this.cacheEnabledKey, 'true');\n    } else {\n      localStorage.removeItem(this.cacheEnabledKey);\n    }\n  }\n\n  public get log() {\n    if (!this.isEnabled()) {\n      return LogNoOp;\n    }\n    const boundLogFn: (...args: any) => void = console.log.bind(\n      console,\n      this.title\n    );\n    return boundLogFn;\n  }\n\n  public get warn() {\n    if (!this.isEnabled()) {\n      return LogNoOp;\n    }\n    const boundLogFn: (...args: any) => void = console.warn.bind(\n      console,\n      this.title\n    );\n    return boundLogFn;\n  }\n\n  public get error() {\n    if (!this.isEnabled()) {\n      return LogNoOp;\n    }\n    const boundLogFn: (...args: any) => void = console.error.bind(\n      console,\n      this.title\n    );\n    return boundLogFn;\n  }\n}\n","import { LoggerBase } from './logger-base';\n\nconst LOGGER_ENABLEDKEY = 'LOGGING_ENABLED';\nexport const logger = new LoggerBase('ðŸ”¥raf:', LOGGER_ENABLEDKEY);\n\nexport const log = logger.log;\nexport const logError = logger.error;\nexport const logWarn = logger.warn;\n","import { RAFirebaseOptions } from 'providers/options';\nimport { LogNoOp, LoggerBase } from './logger-base';\n\nconst LOGGER_ENABLEDKEY = 'LOGGING_FIRESTORE_COSTS_ENABLED';\nconst logger = new LoggerBase('ðŸ’¸firestore-costs:', LOGGER_ENABLEDKEY);\n\nconst KEY_SINGLE = 'firecosts-single-reads';\n\nexport interface IFirestoreLogger {\n  logDocument: (count: number) => Function;\n  SetEnabled: (isEnabled: boolean) => void;\n  ResetCount: (shouldReset: boolean) => void;\n}\n\nexport function MakeFirestoreLogger(\n  options: RAFirebaseOptions\n): IFirestoreLogger {\n  function notEnabled() {\n    return !options?.lazyLoading?.enabled;\n  }\n\n  function incrementRead(incrementBy = 1) {\n    const currentCountRaw = localStorage.getItem(KEY_SINGLE) || '';\n    const currentCount = parseInt(currentCountRaw) || 0;\n    const incremented = currentCount + incrementBy;\n    localStorage.setItem(KEY_SINGLE, incremented + '');\n    return incremented;\n  }\n  function clearCache() {\n    localStorage.removeItem(KEY_SINGLE);\n  }\n  return {\n    SetEnabled(isEnabled: boolean) {\n      logger.SetEnabled(isEnabled);\n    },\n    ResetCount(shouldReset: boolean) {\n      shouldReset && clearCache()\n    },\n    logDocument(docCount: number) {\n      if (notEnabled()) {\n        return LogNoOp;\n      }\n      const count = incrementRead(docCount);\n      const suffix = `+${docCount} (session total=${count} documents read)`;\n      const boundLogFn: (...args: any) => void = logger.log.bind(\n        console,\n        suffix\n      );\n      return boundLogFn;\n    },\n  };\n}\n","import { log } from './logger';\n\nexport type DispatchEvent =\n\t'FILE_UPLOAD_WILL_START' |\n\t'FILE_UPLOAD_PROGRESS' |\n\t'FILE_UPLOAD_PAUSED' |\n\t'FILE_UPLOAD_RUNNING' |\n\t'FILE_UPLOAD_CANCELED' |\n\t'FILE_UPLOAD_COMPLETE' |\n\t'FILE_SAVED';\n\nexport function dispatch(\n\teventName: DispatchEvent,\n\tfileName: string,\n\tdata?: any,\n): void {\n\tconst eventMonitor = document.getElementById('eventMonitor');\n\tif (!eventMonitor) {\n\t\tlog(`eventMonitor not found to dispatch event ${eventName} for ${fileName}`);\n\t\treturn;\n\t}\n\tconst eventData = { fileName, data };\n\tlet event = new CustomEvent(eventName, { detail: eventData });\n\teventMonitor.dispatchEvent(event);\n};","import { set, has } from \"lodash\";\nimport { IFirebaseWrapper } from \"providers/database\";\nimport { REF_INDENTIFIER } from \"./internal.models\";\nimport { logError } from \"./logger\";\nimport { FireStoreDocumentRef } from \"./firebase-models\";\n\nexport interface RefDocFound {\n  fieldPath: string;\n  refDocPath: string;\n}\n\nexport interface FromFirestoreResult {\n  parsedDoc: any;\n  refdocs: RefDocFound[];\n}\n\nexport function translateDocFromFirestore(obj: any) {\n  const isObject = !!obj && typeof obj === \"object\";\n  const result: FromFirestoreResult = {\n    parsedDoc: {},\n    refdocs: [],\n  };\n  if (!isObject) {\n    return result;\n  }\n  Object.keys(obj).map((key) => {\n    const value = obj[key];\n    obj[key] = recusivelyCheckObjectValue(value, key, result);\n  });\n  result.parsedDoc = obj;\n  return result;\n}\n\nexport function recusivelyCheckObjectValue(\n  input: any,\n  fieldPath: string,\n  result: FromFirestoreResult\n): any {\n  const isFalsey = !input;\n  if (isFalsey) {\n    return input;\n  }\n  const isPrimitive = typeof input !== \"object\";\n  if (isPrimitive) {\n    return input;\n  }\n  const isTimestamp = !!input.toDate && typeof input.toDate === \"function\";\n  if (isTimestamp) {\n    return input.toDate();\n  }\n  const isArray = Array.isArray(input);\n  if (isArray) {\n    return (input as any[]).map((value, index) =>\n      recusivelyCheckObjectValue(value, `${fieldPath}.${index}`, result)\n    );\n  }\n  const isDocumentReference = isInputADocReference(input);\n  if (isDocumentReference) {\n    const ref = input as FireStoreDocumentRef;\n    result.refdocs.push({ fieldPath: fieldPath, refDocPath: ref.path });\n    return ref.id;\n  }\n  const isObject = typeof input === \"object\";\n  if (isObject) {\n    Object.keys(input).map((key) => {\n      const value = input[key];\n      input[key] = recusivelyCheckObjectValue(value, key, result);\n    });\n    return input;\n  }\n  return input;\n}\n\nfunction isInputADocReference(input: any): boolean {\n  const isDocumentReference = typeof input.id === \"string\" &&\n    typeof input.firestore === \"object\" &&\n    typeof input.parent === \"object\" &&\n    typeof input.path === \"string\";\n  return isDocumentReference;\n}\n\nexport function applyRefDocs(\n  doc: any,\n  refDocs: RefDocFound[],\n) {\n  refDocs.map((d) => {\n    set(doc, REF_INDENTIFIER + d.fieldPath, d.refDocPath);\n  });\n  return doc;\n}\n\nexport const recursivelyMapStorageUrls = async (\n  fireWrapper: IFirebaseWrapper,\n  fieldValue: any\n): Promise<any> => {\n  const isPrimitive = !fieldValue || typeof fieldValue !== 'object';\n  if (isPrimitive) {\n    return fieldValue\n  }\n  const isFileField = has(fieldValue, 'src');\n  if (isFileField) {\n    try {\n      const src = await fireWrapper\n        .storage()\n        .ref(fieldValue.src)\n        .getDownloadURL();\n      return {\n        ...fieldValue,\n        src,\n      };\n    } catch (error) {\n      logError(`Error when getting download URL`, {\n        error,\n      });\n      return fieldValue;\n    }\n  }\n  const isArray = Array.isArray(fieldValue);\n  if (isArray) {\n    return Promise.all(\n      (fieldValue as any[]).map(async (value, index) => {\n        fieldValue[index] = await recursivelyMapStorageUrls(fireWrapper, value);\n      })\n    ).then(() => fieldValue);\n  }\n  const isDocumentReference = isInputADocReference(fieldValue);\n  if (isDocumentReference) {\n    return fieldValue;\n  }\n  const isObject = !isArray && typeof fieldValue === \"object\";\n  if (isObject) {\n    return Promise.all(\n      Object.keys(fieldValue).map(async (key) => {\n        const value = fieldValue[key];\n        fieldValue[key] = await recursivelyMapStorageUrls(fireWrapper, value);\n      })\n    ).then(() => fieldValue);\n  }\n};\n","import { FireStoreQueryDocumentSnapshot, FireStoreDocumentSnapshot } from \"./firebase-models\";\nimport { logWarn } from \"./logger\";\nimport { applyRefDocs, translateDocFromFirestore } from \"./translate-from-firestore\";\nimport * as ra from './react-admin-models';\n\nexport function parseFireStoreDocument<T extends ra.Record>(doc: FireStoreQueryDocumentSnapshot | FireStoreDocumentSnapshot | undefined): T {\n  if (!doc) {\n    logWarn('parseFireStoreDocument: no doc', { doc });\n    return {} as T;\n  }\n  const data = doc.data();\n  const result = translateDocFromFirestore(data);\n  const dataWithRefs = applyRefDocs(result.parsedDoc, result.refdocs);\n  // React Admin requires an id field on every document,\n  // So we can just using the firestore document id\n  return { id: doc.id, ...dataWithRefs } as T;\n}\n","export const REF_INDENTIFIER = \"___REF_FULLPATH_\";\n\nexport interface ParsedRefDoc {\n  ___refpath: string;\n  ___refid: string;\n}\n","import path from \"path-browserify\";\n\nexport function getAbsolutePath(\n  rootRef: undefined | string | (() => string),\n  relativePath: string | null\n): string {\n  if (!rootRef) {\n    return relativePath+'';\n  }\n  if (!relativePath) {\n    throw new Error(\n      \"Resource name must be a string of length greater than 0 characters\"\n    );\n  }\n  const rootRefValue = typeof rootRef === \"string\" ? rootRef : rootRef();\n  const withSlashes = path.join(\"/\", rootRefValue, \"/\", relativePath, \"/\");\n  const slashCount = withSlashes.split(\"/\").length - 1;\n  if (slashCount % 2) {\n    throw new Error(`The rootRef path must point to a \"document\"\n    not a \"collection\"e.g. /collection/document/ or\n    /collection/document/collection/document/`);\n  }\n  return withSlashes.slice(1, -1);\n}\n\nexport function joinPaths(...args: string[]) {\n  return path.join(...args);\n}\n","import { REF_INDENTIFIER } from \"./internal.models\";\n\ninterface ParsedUpload {\n  fieldDotsPath: string;\n  fieldSlashesPath: string;\n  rawFile: File | any;\n}\n\ninterface ParsedDocRef {\n  fieldDotsPath: string;\n  refPath: string;\n}\n\ninterface ParseResult {\n  parsedDoc: any;\n  uploads: ParsedUpload[];\n  refdocs: ParsedDocRef[];\n}\n\nexport function translateDocToFirestore(obj: any): ParseResult {\n  const isObject = !!obj && typeof obj === \"object\";\n  const result: ParseResult = {\n    uploads: [],\n    refdocs: [],\n    parsedDoc: {},\n  };\n  if (!isObject) {\n    return result;\n  }\n  Object.keys(obj).map((key) => {\n    const value = obj[key];\n    recusivelyParseObjectValue(value, key, result);\n  });\n  result.parsedDoc = obj;\n  return result;\n}\n\nexport function recusivelyParseObjectValue(\n  input: any,\n  fieldPath: string,\n  result: ParseResult\n): any {\n  const isFalsey = !input;\n  if (isFalsey) {\n    return input;\n  }\n  const isRefField =\n    typeof fieldPath === \"string\" && fieldPath.includes(REF_INDENTIFIER);\n  if (isRefField) {\n    const refDocFullPath = input as string;\n    result.refdocs.push({\n      fieldDotsPath: fieldPath,\n      refPath: refDocFullPath,\n    });\n    return;\n  }\n  const isPrimitive = typeof input !== \"object\";\n  if (isPrimitive) {\n    return input;\n  }\n  const isTimestamp = !!input.toDate && typeof input.toDate === \"function\";\n  if (isTimestamp) {\n    return input.toDate();\n  }\n  const isArray = Array.isArray(input);\n  if (isArray) {\n    return (input as []).map((value, index) =>\n      recusivelyParseObjectValue(value, `${fieldPath}.${index}`, result)\n    );\n  }\n  const isFileField = !!input && input.hasOwnProperty(\"rawFile\");\n  if (isFileField) {\n    result.uploads.push({\n      fieldDotsPath: fieldPath,\n      fieldSlashesPath: fieldPath.split(\".\").join(\"/\"),\n      rawFile: input.rawFile,\n    });\n    delete input.rawFile;\n    return;\n  }\n  Object.keys(input).map((key) => {\n    const value = input[key];\n    recusivelyParseObjectValue(value, `${fieldPath}.${key}`, result);\n  });\n  return input;\n}\n","import {\n  IFirebaseWrapper,\n} from './IFirebaseWrapper';\n\nimport firebase from 'firebase/compat/app';\nimport 'firebase/compat/auth';\nimport 'firebase/compat/firestore';\nimport 'firebase/compat/storage';\n\nimport { log } from 'misc';\nimport { RAFirebaseOptions } from 'providers/options';\nimport {\n  FireApp,\n  FireAuth,\n  FireAuthUserCredentials,\n  FireStorage,\n  FireStoragePutFileResult,\n  FireStore,\n  FireStoreBatch,\n  FireStoreCollectionRef,\n  FireUploadTaskSnapshot,\n  FireUser\n} from 'misc/firebase-models';\n\nexport class FirebaseWrapper implements IFirebaseWrapper {\n  private firestore: FireStore;\n  private app: FireApp;\n  public options: RAFirebaseOptions;\n\n  constructor(\n    inputOptions: RAFirebaseOptions | undefined,\n    firebaseConfig: {},\n  ) { \n    const optionsSafe = inputOptions || {};\n    this.options = optionsSafe;\n    this.app = (window as any)['_app'] = ObtainFirebaseApp(firebaseConfig, optionsSafe);\n    this.firestore = this.app.firestore();\n  }\n  dbGetCollection(absolutePath: string): FireStoreCollectionRef {\n    return this.firestore.collection(absolutePath);\n  }\n  dbCreateBatch(): FireStoreBatch {\n    return this.firestore.batch();\n  }\n  dbMakeNewId(): string {\n    return this.firestore.collection(\"collections\").doc().id\n  }\n\n  public OnUserLogout(callBack: (u: FireUser | null) => any) {\n    this.app.auth().onAuthStateChanged((user) => {\n      const isLoggedOut = !user;\n      log('FirebaseWrapper.OnUserLogout', { user, isLoggedOut });\n      if (isLoggedOut) {\n        callBack(user);\n      }\n    });\n  }\n  putFile(storagePath: string, rawFile: any): FireStoragePutFileResult {\n    const task = this.app.storage().ref(storagePath).put(rawFile);\n    const taskResult = new Promise<FireUploadTaskSnapshot>(\n      (res, rej) => task.then(res).catch(rej)\n    );\n    const downloadUrl = taskResult.then(t => t.ref.getDownloadURL()).then(url => url as string)\n    return {\n      task,\n      taskResult,\n      downloadUrl,\n    }\n  }\n  async getStorageDownloadUrl(fieldSrc: string): Promise<string> {\n    return this.app.storage().ref(fieldSrc).getDownloadURL();\n  }\n  public serverTimestamp() {\n    // This line doesn't work for some reason, might be firebase sdk.\n    return firebase.firestore.FieldValue.serverTimestamp();\n  }\n  async authSetPersistence(persistenceInput: 'session' | 'local' | 'none') {\n    let persistenceResolved: string;\n    switch (persistenceInput) {\n      case 'local':\n        persistenceResolved = firebase.auth.Auth.Persistence.LOCAL;\n        break;\n      case 'none':\n        persistenceResolved = firebase.auth.Auth.Persistence.NONE;\n        break;\n      case 'session':\n      default:\n        persistenceResolved = firebase.auth.Auth.Persistence.SESSION;\n        break;\n    }\n    log('setPersistence', { persistenceInput, persistenceResolved });\n    return this.app.auth()\n      .setPersistence(persistenceResolved)\n      .catch((error) => console.error(error));\n  }\n  async authSigninEmailPassword(email: string, password: string): Promise<FireAuthUserCredentials> {\n    const user = await this.app.auth().signInWithEmailAndPassword(\n      email,\n      password\n    );\n    return user;\n  }\n  async authSignOut(): Promise<void> {\n    return this.app.auth().signOut();\n  }\n  async authGetUserLoggedIn(): Promise<FireUser> {\n    return new Promise((resolve, reject) => {\n      const auth = this.app.auth();\n      if (auth.currentUser) return resolve(auth.currentUser);\n      const unsubscribe = this.app.auth().onAuthStateChanged((user) => {\n        unsubscribe();\n        if (user) {\n          resolve(user);\n        } else {\n          reject();\n        }\n      });\n    });\n  }\n  public async GetUserLogin(): Promise<FireUser> {\n    return this.authGetUserLoggedIn();\n  }\n\n  /** @deprecated */\n  public auth(): FireAuth {\n    return this.app.auth();\n  }\n  /** @deprecated */\n  public storage(): FireStorage {\n    return this.app.storage();\n  }\n  /** @deprecated */\n  public GetApp(): FireApp {\n    return this.app;\n  }\n  /** @deprecated */\n  public db(): FireStore {\n    return this.firestore;\n  }\n}\n\nfunction ObtainFirebaseApp(\n  firebaseConfig: {},\n  options: RAFirebaseOptions\n): firebase.app.App {\n  if (options.app) {\n    return options.app;\n  }\n  const isInitialized = !!firebase.apps?.length;\n  if (isInitialized) {\n    return firebase.app();\n  } else {\n    return firebase.initializeApp(firebaseConfig);\n  }\n}\n","import firebase from 'firebase/compat/app';\nimport 'firebase/compat/storage';\n\nexport type FireUser = firebase.User;\nexport type FireApp = firebase.app.App;\n\nexport type FireStorage = firebase.storage.Storage;\nexport type FireStorageReference = firebase.storage.Reference;\nexport type FireUploadTaskSnapshot = firebase.storage.UploadTaskSnapshot;\nexport type FireUploadTask = firebase.storage.UploadTask;\nexport type FireStoragePutFileResult = {\n  task: FireUploadTask, \n  taskResult: Promise<FireUploadTaskSnapshot>,\n  downloadUrl: Promise<string>,\n}\n\nexport type FireAuth = firebase.auth.Auth;\nexport type FireAuthUserCredentials = firebase.auth.UserCredential;\n\nexport type FireStore = firebase.firestore.Firestore;\nexport type FireStoreBatch = firebase.firestore.WriteBatch;\nexport type FireStoreTimeStamp = firebase.firestore.FieldValue;\nexport type FireStoreDocumentRef = firebase.firestore.DocumentReference;\nexport type FireStoreDocumentSnapshot = firebase.firestore.DocumentSnapshot<firebase.firestore.DocumentData>;\nexport type FireStoreCollectionRef = firebase.firestore.CollectionReference;\nexport type FireStoreQueryDocumentSnapshot = firebase.firestore.QueryDocumentSnapshot;\nexport type FireStoreQuery = firebase.firestore.Query;\nexport type FireStoreQueryOrder = firebase.firestore.OrderByDirection;\n\nexport const TASK_PAUSED = firebase.storage.TaskState.PAUSED\nexport const TASK_RUNNING = firebase.storage.TaskState.RUNNING\nexport const TASK_CANCELED = firebase.storage.TaskState.CANCELED\n","import { RAFirebaseOptions } from '../options';\nimport { IFirebaseWrapper } from './firebase/IFirebaseWrapper';\nimport {\n  log,\n  getAbsolutePath,\n  messageTypes,\n  logWarn,\n  IFirestoreLogger,\n  parseFireStoreDocument,\n} from '../../misc';\nimport { FireStoreCollectionRef } from 'misc/firebase-models';\n\ntype IResourceItem = {} & { id: string, deleted?: boolean };\nexport interface IResource {\n  path: string;\n  pathAbsolute: string;\n  collection: FireStoreCollectionRef;\n  list: Array<IResourceItem>;\n}\n\nexport class ResourceManager {\n  private resources: Record<string, IResource> = {};\n\n  constructor(\n    private fireWrapper: IFirebaseWrapper,\n    private options: RAFirebaseOptions,\n    private flogger: IFirestoreLogger\n  ) {\n    this.fireWrapper.OnUserLogout(() => {\n      this.resources = {};\n    });\n  }\n\n  public async TryGetResource(\n    resourceName: string,\n    refresh?: 'REFRESH',\n    collectionQuery?: messageTypes.CollectionQueryType\n  ): Promise<IResource> {\n    if (refresh) {\n      await this.RefreshResource(resourceName, collectionQuery);\n    }\n    return this.TryGetResourcePromise(resourceName, collectionQuery);\n  }\n\n  public GetResource(relativePath: string): IResource {\n    const resource: IResource = this.resources[relativePath];\n    if (!resource) {\n      throw new Error(\n        `react-admin-firebase: Can't find resource: \"${relativePath}\"`\n      );\n    }\n    return resource;\n  }\n\n  public async TryGetResourcePromise(\n    relativePath: string,\n    collectionQuery?: messageTypes.CollectionQueryType\n  ): Promise<IResource> {\n    log('resourceManager.TryGetResourcePromise', {\n      relativePath,\n      collectionQuery,\n    });\n    await this.initPath(relativePath);\n\n    const resource: IResource = this.resources[relativePath];\n    if (!resource) {\n      throw new Error(\n        `react-admin-firebase: Cant find resource: \"${relativePath}\"`\n      );\n    }\n    return resource;\n  }\n\n  public async RefreshResource(\n    relativePath: string,\n    collectionQuery: messageTypes.CollectionQueryType | undefined\n  ) {\n    if (this.options?.lazyLoading?.enabled) {\n      logWarn('resourceManager.RefreshResource', {\n        warn: 'RefreshResource is not available in lazy loading mode',\n      });\n      throw new Error(\n        'react-admin-firebase: RefreshResource is not available in lazy loading mode'\n      );\n    }\n\n    log('resourceManager.RefreshResource', { relativePath, collectionQuery });\n    await this.initPath(relativePath);\n    const resource = this.resources[relativePath];\n\n    const collection = resource.collection;\n    const query = this.applyQuery(collection, collectionQuery);\n    const newDocs = await query.get();\n\n    resource.list = newDocs.docs.map((doc) => parseFireStoreDocument<IResourceItem>(doc));\n    const count = newDocs.docs.length;\n    this.flogger.logDocument(count)();\n    log('resourceManager.RefreshResource', {\n      newDocs,\n      resource,\n      collectionPath: collection.path,\n    });\n  }\n\n  public async GetSingleDoc(relativePath: string, docId: string) {\n    await this.initPath(relativePath);\n    const resource = this.GetResource(relativePath);\n    this.flogger.logDocument(1)();\n    const docSnap = await resource.collection.doc(docId).get();\n    if (!docSnap.exists) {\n      throw new Error('react-admin-firebase: No id found matching: ' + docId);\n    }\n    const result = parseFireStoreDocument(docSnap);\n    log('resourceManager.GetSingleDoc', {\n      relativePath,\n      resource,\n      docId,\n      docSnap,\n      result,\n    });\n    return result;\n  }\n\n  private async initPath(relativePath: string): Promise<void> {\n    const rootRef = this.options && this.options.rootRef;\n    const absolutePath = getAbsolutePath(rootRef, relativePath);\n    const hasBeenInited = !!this.resources[relativePath];\n    log('resourceManager.initPath()', {\n      absolutePath,\n      hasBeenInited,\n    });\n    if (hasBeenInited) {\n      log('resourceManager.initPath() has been initialized already...');\n      return;\n    }\n    const collection = this.fireWrapper.dbGetCollection(absolutePath);\n    const list: Array<IResourceItem> = [];\n    const resource: IResource = {\n      collection,\n      list,\n      path: relativePath,\n      pathAbsolute: absolutePath,\n    };\n    this.resources[relativePath] = resource;\n    log('resourceManager.initPath() setting resource...', {\n      resource,\n      allResources: this.resources,\n      collection: collection,\n      collectionPath: collection.path,\n    });\n  }\n\n  public async getUserIdentifier(): Promise<string> {\n    const identifier = this.options.associateUsersById\n      ? await this.getCurrentUserId()\n      : await this.getCurrentUserEmail();\n    return identifier;\n  }\n\n  private async getCurrentUserEmail() {\n    const user = await this.fireWrapper.authGetUserLoggedIn();\n    if (user) {\n      return user.email as string;\n    } else {\n      return 'annonymous user';\n    }\n  }\n  private async getCurrentUserId() {\n    const user = await this.fireWrapper.authGetUserLoggedIn();\n    if (user) {\n      return user.uid;\n    } else {\n      return 'annonymous user';\n    }\n  }\n\n  private applyQuery(\n    collection: FireStoreCollectionRef,\n    collectionQuery?: messageTypes.CollectionQueryType\n  ): FireStoreCollectionRef {\n    const collRef = collectionQuery ? collectionQuery(collection) : collection;\n\n    log('resourceManager.applyQuery() ...', {\n      collection,\n      collectionQuery: (collectionQuery || '-').toString(),\n      collRef,\n    });\n    return collRef;\n  }\n}\n","import { set, get } from \"lodash\";\nimport { TASK_CANCELED, TASK_PAUSED, TASK_RUNNING } from \"../../misc/firebase-models\";\nimport {\n  AddCreatedByFields,\n  AddUpdatedByFields,\n  IFirestoreLogger,\n  joinPaths,\n  log,\n  logError,\n  dispatch,\n  translateDocToFirestore,\n  parseStoragePath,\n} from \"../../misc\";\nimport { RAFirebaseOptions } from \"../options\";\nimport { IFirebaseWrapper } from \"./firebase/IFirebaseWrapper\";\nimport { IResource, ResourceManager } from \"./ResourceManager\";\n\nexport class FireClient {\n  public rm: ResourceManager;\n\n  constructor(\n    public fireWrapper: IFirebaseWrapper,\n    public options: RAFirebaseOptions,\n    public flogger: IFirestoreLogger\n  ) {\n    this.rm = new ResourceManager(this.fireWrapper, this.options, this.flogger);\n  }\n\n  public checkRemoveIdField(obj: any, docId: string) {\n    if (!this.options.dontAddIdFieldToDoc) {\n      obj.id = docId;\n    }\n  }\n\n  public transformToDb(resourceName: string, documentData: any, docId: string): any {\n    if (typeof this.options.transformToDb === 'function') {\n      return this.options.transformToDb(resourceName, documentData, docId);\n    }\n    return documentData;\n  }\n\n  public async parseDataAndUpload(r: IResource, id: string, data: any) {\n    if (!data) {\n      return data;\n    }\n    const docPath = r.collection.doc(id).path;\n\n    const result = translateDocToFirestore(data);\n    const uploads = result.uploads;\n    await Promise.all(\n      uploads.map(async (u) => {\n        const storagePath = parseStoragePath(u.rawFile, docPath, u.fieldDotsPath, !!this.options.useFileNamesInStorage);\n        const link = await this.saveFile(storagePath, u.rawFile);\n        set(data, u.fieldDotsPath + \".src\", link);\n      })\n    );\n    return data;\n  }\n\n  public async addCreatedByFields(obj: any) {\n    return AddCreatedByFields(obj, this.fireWrapper, this.rm, this.options);\n  }\n\n  public async addUpdatedByFields(obj: any) {\n    return AddUpdatedByFields(obj, this.fireWrapper, this.rm, this.options);\n  }\n\n  private async saveFile(\n    storagePath: string,\n    rawFile: any\n  ): Promise<string | undefined> {\n    log(\"saveFile() saving file...\", { storagePath, rawFile });\n    try {\n      const { task, taskResult, downloadUrl } = this.fireWrapper.putFile(storagePath, rawFile);\n      const { name } = rawFile;\n      // monitor upload status & progress\n      dispatch('FILE_UPLOAD_WILL_START', name);\n      task.on('state_changed', (snapshot) => {\n        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\n        log('Upload is ' + progress + '% done');\n        dispatch('FILE_UPLOAD_PROGRESS', name, progress);\n        switch (snapshot.state) {\n          case TASK_PAUSED:\n            log('Upload is paused');\n            dispatch('FILE_UPLOAD_PAUSED', name);\n            break;\n          case TASK_RUNNING:\n            log('Upload is running');\n            dispatch('FILE_UPLOAD_RUNNING', name);\n            break;\n          case TASK_CANCELED:\n            log('Upload has been canceled');\n            dispatch('FILE_UPLOAD_CANCELED', name);\n            break;\n          // case storage.TaskState.ERROR:\n          // already handled by catch\n          // case storage.TaskState.SUCCESS:\n          // already handled by then\n        }\n      });\n      const [getDownloadURL] = await Promise.all([\n        downloadUrl,\n        taskResult,\n      ]);\n      dispatch('FILE_UPLOAD_COMPLETE', name);\n      dispatch('FILE_SAVED', name);\n      log(\"saveFile() saved file\", {\n        storagePath,\n        taskResult,\n        getDownloadURL,\n      });\n      return this.options.relativeFilePaths ? storagePath : getDownloadURL;\n    } catch (storageError) {\n      if (get(storageError, 'code') === \"storage/unknown\") {\n        logError(\n          'saveFile() error saving file, No bucket found! Try clicking \"Get Started\" in firebase -> storage',\n          { storageError }\n        );\n      } else {\n        logError(\"saveFile() error saving file\", {\n          storageError,\n        });\n      }\n    }\n  }\n}\n","import { joinPaths } from \"./pathHelper\";\n\nexport function parseStoragePath(\n  rawFile: File,\n  docPath: string,\n  fieldPath: string,\n  useFileName: boolean\n): string {\n  const fileNameBits = rawFile instanceof File\n    ? rawFile.name.split('.')\n    : [];\n\n  const fileExtension = !fileNameBits?.length\n    ? ''\n    : '.' + fileNameBits.pop();\n\n  return useFileName\n    ? joinPaths(docPath, fieldPath, rawFile.name)\n    : joinPaths(docPath, fieldPath + fileExtension);\n}","import { RAFirebaseOptions } from \"index\";\nimport { IFirebaseWrapper, ResourceManager } from \"providers/database\";\n\nexport async function AddCreatedByFields(\n  obj: any,\n  fireWrapper: IFirebaseWrapper,\n  rm: Pick<ResourceManager, \"getUserIdentifier\">,\n  options: Pick<\n    RAFirebaseOptions,\n    | \"associateUsersById\"\n    | \"disableMeta\"\n    | \"renameMetaFields\"\n    | \"metaFieldCasing\"\n  >\n) {\n  if (options.disableMeta) {\n    return;\n  }\n  const currentUserIdentifier = await rm.getUserIdentifier();\n  const createAtSelector = GetSelectorsCreateAt(options);\n  const createBySelector = GetSelectorsCreateBy(options);\n  obj[createAtSelector] = fireWrapper.serverTimestamp();\n  obj[createBySelector] = currentUserIdentifier;\n}\n\nexport async function AddUpdatedByFields(\n  obj: any,\n  fireWrapper: IFirebaseWrapper,\n  rm: Pick<ResourceManager, \"getUserIdentifier\">,\n  options: Pick<\n    RAFirebaseOptions,\n    | \"associateUsersById\"\n    | \"disableMeta\"\n    | \"renameMetaFields\"\n    | \"metaFieldCasing\"\n  >\n) {\n  if (options.disableMeta) {\n    return;\n  }\n  const currentUserIdentifier = await rm.getUserIdentifier();\n  const updateAtSelector = GetSelectorsUpdateAt(options);\n  const updateBySelector = GetSelectorsUpdateBy(options);\n  obj[updateAtSelector] = fireWrapper.serverTimestamp();\n  obj[updateBySelector] = currentUserIdentifier;\n}\n\nexport function GetSelectorsUpdateAt(\n  options: Pick<RAFirebaseOptions, \"metaFieldCasing\" | \"renameMetaFields\">\n): string {\n  if (options.renameMetaFields && options.renameMetaFields.updated_at) {\n    return options.renameMetaFields.updated_at;\n  }\n  const casing = options.metaFieldCasing;\n  const defautCase = \"lastupdate\";\n  if (!casing) {\n    return defautCase;\n  }\n  if (casing === \"camel\") {\n    return \"lastUpdate\";\n  }\n  if (casing === \"snake\") {\n    return \"last_update\";\n  }\n  if (casing === \"pascal\") {\n    return \"LastUpdate\";\n  }\n  if (casing === \"kebab\") {\n    return \"last-update\";\n  }\n  return defautCase;\n}\n\nexport function GetSelectorsUpdateBy(\n  options: Pick<RAFirebaseOptions, \"metaFieldCasing\" | \"renameMetaFields\">\n): string {\n  if (options.renameMetaFields && options.renameMetaFields.updated_by) {\n    return options.renameMetaFields.updated_by;\n  }\n  const casing = options.metaFieldCasing;\n  const defautCase = \"updatedby\";\n  if (!casing) {\n    return defautCase;\n  }\n  if (casing === \"camel\") {\n    return \"updatedBy\";\n  }\n  if (casing === \"snake\") {\n    return \"updated_by\";\n  }\n  if (casing === \"pascal\") {\n    return \"UpdatedBy\";\n  }\n  if (casing === \"kebab\") {\n    return \"updated-by\";\n  }\n  return defautCase;\n}\n\nexport function GetSelectorsCreateAt(\n  options: Pick<RAFirebaseOptions, \"metaFieldCasing\" | \"renameMetaFields\">\n): string {\n  if (options.renameMetaFields && options.renameMetaFields.created_at) {\n    return options.renameMetaFields.created_at;\n  }\n  const casing = options.metaFieldCasing;\n  const defautCase = \"createdate\";\n  if (!casing) {\n    return defautCase;\n  }\n  if (casing === \"camel\") {\n    return \"createDate\";\n  }\n  if (casing === \"snake\") {\n    return \"create_date\";\n  }\n  if (casing === \"pascal\") {\n    return \"CreateDate\";\n  }\n  if (casing === \"kebab\") {\n    return \"create-date\";\n  }\n  return defautCase;\n}\n\nexport function GetSelectorsCreateBy(\n  options: Pick<RAFirebaseOptions, \"metaFieldCasing\" | \"renameMetaFields\">\n): string {\n  if (options.renameMetaFields && options.renameMetaFields.created_by) {\n    return options.renameMetaFields.created_by;\n  }\n  const casing = options.metaFieldCasing;\n  const defautCase = \"createdby\";\n  if (!casing) {\n    return defautCase;\n  }\n  if (casing === \"camel\") {\n    return \"createdBy\";\n  }\n  if (casing === \"snake\") {\n    return \"created_by\";\n  }\n  if (casing === \"pascal\") {\n    return \"CreatedBy\";\n  }\n  if (casing === \"kebab\") {\n    return \"created-by\";\n  }\n  return defautCase;\n}\n","import { FireStoreCollectionRef, FireStoreDocumentSnapshot, FireStoreQuery } from 'misc/firebase-models';\nimport { IFirestoreLogger, messageTypes } from '../../misc';\n\nexport function setQueryCursor(\n  doc: FireStoreDocumentSnapshot,\n  params: messageTypes.IParamsGetList,\n  resourceName: string\n) {\n  const key = btoa(JSON.stringify({ ...params, resourceName }));\n  localStorage.setItem(key, doc.id);\n\n  const allCursorsKey = `ra-firebase-cursor-keys_${resourceName}`;\n  const localCursorKeys = localStorage.getItem(allCursorsKey);\n  if (!localCursorKeys) {\n    localStorage.setItem(allCursorsKey, JSON.stringify([key]));\n  } else {\n    const cursors: string[] = JSON.parse(localCursorKeys);\n    const newCursors = cursors.concat(key);\n    localStorage.setItem(allCursorsKey, JSON.stringify(newCursors));\n  }\n}\n\nexport async function getQueryCursor(\n  collection: FireStoreCollectionRef,\n  params: messageTypes.IParamsGetList,\n  resourceName: string,\n  flogger: IFirestoreLogger\n): Promise<FireStoreDocumentSnapshot | false> {\n  const key = btoa(JSON.stringify({ ...params, resourceName }));\n  const docId = localStorage.getItem(key);\n  if (!docId) {\n    return false;\n  }\n\n  const doc = await collection.doc(docId).get();\n  flogger.logDocument(1)();\n  if (doc.exists) {\n    // incrementFirebaseReadsCounter(1);\n    return doc;\n  }\n  return false;\n}\n\nexport function clearQueryCursors(resourceName: string) {\n  const allCursorsKey = `ra-firebase-cursor-keys_${resourceName}`;\n  const localCursorKeys = localStorage.getItem(allCursorsKey);\n  if (localCursorKeys) {\n    const cursors: string[] = JSON.parse(localCursorKeys);\n    cursors.forEach((cursor) => localStorage.removeItem(cursor));\n    localStorage.removeItem(allCursorsKey);\n  }\n}\n\nexport async function findLastQueryCursor(\n  collection: FireStoreCollectionRef,\n  queryBase: FireStoreQuery,\n  params: messageTypes.IParamsGetList,\n  resourceName: string,\n  flogger: IFirestoreLogger\n) {\n  const { page, perPage } = params.pagination;\n\n  let lastQueryCursor: FireStoreDocumentSnapshot | false = false;\n  let currentPage = page - 1;\n\n  const currentPageParams = {\n    ...params,\n    pagination: {\n      ...params.pagination,\n    },\n  };\n  while (!lastQueryCursor && currentPage > 1) {\n    currentPage--;\n    currentPageParams.pagination.page = currentPage;\n    console.log('getting query cursor currentPage=', currentPage);\n    lastQueryCursor = await getQueryCursor(\n      collection,\n      currentPageParams,\n      resourceName,\n      flogger\n    );\n  }\n  const limit = (page - currentPage) * perPage;\n  const isFirst = currentPage === 1;\n\n  function getQuery() {\n    if (isFirst) {\n      return queryBase.limit(limit);\n    } else {\n      return queryBase.startAt(lastQueryCursor).limit(limit);\n    }\n  }\n\n  const newQuery = getQuery();\n  const snapshots = await newQuery.get();\n  const docsLength = snapshots.docs.length;\n  flogger.logDocument(docsLength)();\n  const lastDocIndex = docsLength - 1;\n  const lastDocRef = snapshots.docs[lastDocIndex];\n  return lastDocRef;\n}\n","import { FireStoreCollectionRef, FireStoreQuery, FireStoreQueryOrder } from 'misc/firebase-models';\nimport { IFirestoreLogger, messageTypes } from '../../misc';\nimport { findLastQueryCursor, getQueryCursor } from './queryCursors';\n\ninterface ParamsToQueryOptions {\n  filters?: boolean;\n  sort?: boolean;\n  pagination?: boolean;\n}\n\nconst defaultParamsToQueryOptions = {\n  filters: true,\n  sort: true,\n  pagination: true,\n};\n\nexport async function paramsToQuery<\n  TParams extends messageTypes.IParamsGetList\n>(\n  collection: FireStoreCollectionRef,\n  params: TParams,\n  resourceName: string,\n  flogger: IFirestoreLogger,\n  options: ParamsToQueryOptions = defaultParamsToQueryOptions\n): Promise<FireStoreQuery> {\n  const filtersStepQuery = options.filters\n    ? filtersToQuery(collection, params.filter)\n    : collection;\n\n  const sortStepQuery = options.sort\n    ? sortToQuery(filtersStepQuery, params.sort)\n    : filtersStepQuery;\n\n  return options.pagination\n    ? paginationToQuery(\n        sortStepQuery,\n        params,\n        collection,\n        resourceName,\n        flogger\n      )\n    : sortStepQuery;\n}\n\nexport function filtersToQuery(\n  query: FireStoreQuery,\n  filters: { [fieldName: string]: any }\n): FireStoreQuery {\n  const res = Object.entries(filters).reduce((acc,[fieldName, fieldValue]) => {\n    const opStr = fieldValue && Array.isArray(fieldValue) ? 'in' : '==';\n    return acc.where(fieldName, opStr, fieldValue);\n  }, query);\n  return res;\n}\n\nexport function sortToQuery(\n  query: FireStoreQuery,\n  sort: { field: string; order: string }\n): FireStoreQuery {\n  if (sort != null && sort.field !== 'id') {\n    const { field, order } = sort;\n    const parsedOrder = order.toLocaleLowerCase() as FireStoreQueryOrder;\n    return query.orderBy(field, parsedOrder);\n  }\n  return query;\n}\n\nasync function paginationToQuery<TParams extends messageTypes.IParamsGetList>(\n  query: FireStoreQuery,\n  params: TParams,\n  collection: FireStoreCollectionRef,\n  resourceName: string,\n  flogger: IFirestoreLogger\n): Promise<FireStoreQuery> {\n  const { page, perPage } = params.pagination;\n  if (page === 1) {\n    query = query.limit(perPage);\n  } else {\n    let queryCursor = await getQueryCursor(\n      collection,\n      params,\n      resourceName,\n      flogger\n    );\n    if (!queryCursor) {\n      queryCursor = await findLastQueryCursor(\n        collection,\n        query,\n        params,\n        resourceName,\n        flogger\n      );\n    }\n    query = query.startAfter(queryCursor).limit(perPage);\n  }\n\n  return query;\n}\n\nexport function getFullParamsForQuery<\n  TParams extends messageTypes.IParamsGetList\n>(reactAdminParams: TParams, softdeleteEnabled: boolean): TParams {\n  return {\n    ...reactAdminParams,\n    filter: softdeleteEnabled\n      ? {\n          deleted: false,\n          ...reactAdminParams.filter,\n        }\n      : reactAdminParams.filter,\n  };\n}\n\nexport function getNextPageParams<TParams extends messageTypes.IParamsGetList>(\n  params: TParams\n): TParams {\n  return {\n    ...params,\n    pagination: {\n      ...params.pagination,\n      page: params.pagination.page + 1,\n    },\n  };\n}\n","import {\n  log,\n  messageTypes,\n  parseFireStoreDocument,\n  recursivelyMapStorageUrls,\n} from '../../misc';\nimport { IResource, ResourceManager } from '../database/ResourceManager';\nimport { RAFirebaseOptions } from '../options';\nimport * as ra from '../../misc/react-admin-models';\nimport {\n  getFullParamsForQuery,\n  getNextPageParams,\n  paramsToQuery,\n} from './paramsToQuery';\nimport { clearQueryCursors, setQueryCursor } from './queryCursors';\nimport { FireClient } from 'providers/database';\nimport { FireStoreCollectionRef, FireStoreDocumentSnapshot } from 'misc/firebase-models';\n\nexport class FirebaseLazyLoadingClient {\n  constructor(\n    private readonly options: RAFirebaseOptions,\n    private readonly rm: ResourceManager,\n    private client: FireClient\n  ) {}\n\n  public async apiGetList<T extends ra.Record>(\n    resourceName: string,\n    reactAdminParams: ra.GetListParams\n  ): Promise<ra.GetListResult<T>> {\n    const r = await this.tryGetResource(resourceName);\n    const params = getFullParamsForQuery(\n      reactAdminParams,\n      !!this.options.softDelete\n    );\n\n    log('apiGetListLazy', { resourceName, params });\n\n    const query = await paramsToQuery(\n      r.collection,\n      params,\n      resourceName,\n      this.client.flogger\n    );\n\n    const snapshots = await query.get();\n\n    const resultsCount = snapshots.docs.length;\n    if (!resultsCount) {\n      log('apiGetListLazy', {\n        message: 'There are not records for given query',\n      });\n      return { data: [], total: 0 };\n    }\n    this.client.flogger.logDocument(resultsCount)();\n\n    const data = snapshots.docs.map(doc => parseFireStoreDocument<T>(doc));\n    const nextPageCursor = snapshots.docs[snapshots.docs.length - 1];\n    // After fetching documents save queryCursor for next page\n    setQueryCursor(nextPageCursor, getNextPageParams(params), resourceName);\n    // Hardcoded to allow next pages, as we don't have total number of items\n    let total = 9000;\n\n    // Check for next pages\n    // If it's last page, we can count all items and disable going to next page\n    const isOnLastPage = await this.checkIfOnLastPage(\n      r.collection,\n      params,\n      resourceName,\n      nextPageCursor\n    );\n\n    if (isOnLastPage) {\n      const { page, perPage } = params.pagination;\n      total = (page - 1) * perPage + data.length;\n      log('apiGetListLazy', { message: \"It's last page of collection.\" });\n    }\n\n    if (this.options.relativeFilePaths) {\n      const parsedData = await Promise.all(\n        data.map(async (doc: any) => {\n          for (let fieldName in doc) {\n            doc[fieldName] = await recursivelyMapStorageUrls(\n              this.client.fireWrapper,\n              doc[fieldName]\n            );\n          }\n          return doc;\n        })\n      );\n\n      log('apiGetListLazy result', {\n        docs: parsedData,\n        resource: r,\n        collectionPath: r.collection.path,\n      });\n\n      return {\n        data: parsedData,\n        total,\n      };\n    }\n\n    log('apiGetListLazy result', {\n      docs: data,\n      resource: r,\n      collectionPath: r.collection.path,\n    });\n\n    return { data, total };\n  }\n\n  public async apiGetManyReference(\n    resourceName: string,\n    reactAdminParams: messageTypes.IParamsGetManyReference\n  ): Promise<messageTypes.IResponseGetManyReference> {\n    const r = await this.tryGetResource(resourceName);\n    log('apiGetManyReferenceLazy', {\n      resourceName,\n      resource: r,\n      reactAdminParams,\n    });\n    const filterWithTarget = {\n      ...reactAdminParams.filter,\n      [reactAdminParams.target]: reactAdminParams.id,\n    };\n    const params = getFullParamsForQuery(\n      {\n        ...reactAdminParams,\n        filter: filterWithTarget,\n      },\n      !!this.options.softDelete\n    );\n\n    const query = await paramsToQuery(\n      r.collection,\n      params,\n      resourceName,\n      this.client.flogger\n    );\n\n    const snapshots = await query.get();\n    const resultsCount = snapshots.docs.length;\n    this.client.flogger.logDocument(resultsCount)();\n    const data = snapshots.docs.map(d => parseFireStoreDocument(d));\n    if (this.options.relativeFilePaths) {\n      const parsedData = await Promise.all(\n        data.map(async (doc: any) => {\n          for (let fieldName in doc) {\n            doc[fieldName] = await recursivelyMapStorageUrls(\n              this.client.fireWrapper,\n              doc[fieldName]\n            );\n          }\n          return doc;\n        })\n      );\n\n      log('apiGetManyReferenceLazy result', {\n        docs: parsedData,\n        resource: r,\n        collectionPath: r.collection.path,\n      });\n\n      return {\n        data: parsedData,\n        total: data.length,\n      };\n    }\n\n    log('apiGetManyReferenceLazy result', {\n      docs: data,\n      resource: r,\n      collectionPath: r.collection.path,\n    });\n    return { data, total: data.length };\n  }\n\n  private async checkIfOnLastPage<TParams extends messageTypes.IParamsGetList>(\n    collection: FireStoreCollectionRef,\n    params: TParams,\n    resourceName: string,\n    nextPageCursor: FireStoreDocumentSnapshot,\n  ): Promise<boolean> {\n    const query = await paramsToQuery(\n      collection,\n      params,\n      resourceName,\n      this.client.flogger,\n      {\n        filters: true,\n        sort: true,\n      }\n    );\n    if (!nextPageCursor) {\n      throw new Error('Page cursor was empty...');\n    }\n    const nextElementSnapshot = await query\n      .startAfter(nextPageCursor)\n      .limit(1)\n      .get();\n\n    if (!nextElementSnapshot.empty) {\n      // this.incrementFirebaseReadsCounter(1);\n    }\n\n    return nextElementSnapshot.empty;\n  }\n\n  public clearQueryCursors(resourceName: string) {\n    clearQueryCursors(resourceName);\n  }\n\n  private async tryGetResource(\n    resourceName: string,\n    collectionQuery?: messageTypes.CollectionQueryType\n  ): Promise<IResource> {\n    return this.rm.TryGetResourcePromise(resourceName, collectionQuery);\n  }\n}\n","import { messageTypes } from './../misc/messageTypes';\nimport { log, retrieveStatusTxt, logWarn, logger } from '../misc';\nimport { RAFirebaseOptions } from './options';\nimport { FirebaseWrapper } from './database/firebase/FirebaseWrapper';\nimport {\n  AuthProvider as RaAuthProvider,\n  UserIdentity,\n} from '../misc/react-admin-models';\nimport { IFirebaseWrapper } from './database';\nimport { FireUser } from '../misc/firebase-models';\n\nclass AuthClient {\n  private fireWrapper: IFirebaseWrapper;\n\n  constructor(firebaseConfig: {}, optionsInput?: RAFirebaseOptions) {\n    const options = optionsInput || {};\n    log('Auth Client: initializing...', { firebaseConfig, options });\n    this.fireWrapper = new FirebaseWrapper(options, firebaseConfig);\n    options.persistence && this.setPersistence(options.persistence);\n  }\n\n  setPersistence(persistenceInput: 'session' | 'local' | 'none') {\n    return this.fireWrapper.authSetPersistence(persistenceInput);\n  }\n\n  public async HandleAuthLogin(params: { username: string; password: string }) {\n    const { username, password } = params;\n\n    if (username && password) {\n      try {\n        const user = await this.fireWrapper.authSigninEmailPassword(\n          username,\n          password\n        );\n        log('HandleAuthLogin: user sucessfully logged in', { user });\n        return user;\n      } catch (e) {\n        log('HandleAuthLogin: invalid credentials', { params });\n        throw new Error('Login error: invalid credentials');\n      }\n    } else {\n      return this.getUserLogin();\n    }\n  }\n\n  public HandleAuthLogout() {\n    return this.fireWrapper.authSignOut();\n  }\n\n  public HandleAuthError(errorHttp: messageTypes.HttpErrorType) {\n    log('HandleAuthLogin: invalid credentials', { errorHttp });\n    const status = !!errorHttp && errorHttp.status;\n    const statusTxt = retrieveStatusTxt(status);\n    if (statusTxt === 'ok') {\n      log('API is actually authenticated');\n      return Promise.resolve();\n    }\n    logWarn('Received authentication error from API');\n    return Promise.reject();\n  }\n\n  public async HandleAuthCheck(): Promise<any> {\n    return this.getUserLogin();\n  }\n\n  public getUserLogin(): Promise<FireUser> {\n    return this.fireWrapper.authGetUserLoggedIn();\n  }\n\n  public async HandleGetPermissions() {\n    try {\n      const user = await this.getUserLogin();\n      // @ts-ignore\n      const token = await user.getIdTokenResult();\n\n      return token.claims;\n    } catch (e) {\n      log('HandleGetPermission: no user is logged in or tokenResult error', {\n        e,\n      });\n      return null;\n    }\n  }\n\n  public async HandleGetIdentity(): Promise<UserIdentity> {\n    try {\n      const { uid, displayName, photoURL } = await this.getUserLogin();\n      const identity: UserIdentity = {\n        id: uid,\n        fullName: `${displayName ?? ''}`,\n        avatar: `${photoURL ?? ''}`,\n      };\n      return identity;\n    } catch (e) {\n      log('HandleGetIdentity: no user is logged in', {\n        e,\n      });\n      return null as any;\n    }\n  }\n\n  public async HandleGetJWTAuthTime() {\n    try {\n      const user = await this.getUserLogin();\n      // @ts-ignore\n      const token = await user.getIdTokenResult();\n\n      return token.authTime;\n    } catch (e) {\n      log('HandleGetJWTAuthTime: no user is logged in or tokenResult error', {\n        e,\n      });\n      return null;\n    }\n  }\n\n  public async HandleGetJWTExpirationTime() {\n    try {\n      const user = await this.getUserLogin();\n      // @ts-ignore\n      const token = await user.getIdTokenResult();\n\n      return token.expirationTime;\n    } catch (e) {\n      log(\n        'HandleGetJWTExpirationTime: no user is logged in or tokenResult error',\n        {\n          e,\n        }\n      );\n      return null;\n    }\n  }\n\n  public async HandleGetJWTSignInProvider() {\n    try {\n      const user = await this.getUserLogin();\n      // @ts-ignore\n      const token = await user.getIdTokenResult();\n\n      return token.signInProvider;\n    } catch (e) {\n      log(\n        'HandleGetJWTSignInProvider: no user is logged in or tokenResult error',\n        {\n          e,\n        }\n      );\n      return null;\n    }\n  }\n\n  public async HandleGetJWTIssuedAtTime() {\n    try {\n      const user = await this.getUserLogin();\n      // @ts-ignore\n      const token = await user.getIdTokenResult();\n\n      return token.issuedAtTime;\n    } catch (e) {\n      log(\n        'HandleGetJWTIssuedAtTime: no user is logged in or tokenResult error',\n        {\n          e,\n        }\n      );\n      return null;\n    }\n  }\n\n  public async HandleGetJWTToken() {\n    try {\n      const user = await this.getUserLogin();\n      // @ts-ignore\n      const token = await user.getIdTokenResult();\n\n      return token.token;\n    } catch (e) {\n      log(\n        'HandleGetJWTToken: no user is logged in or tokenResult error',\n        {\n          e,\n        }\n      );\n      return null;\n    }\n  }\n}\n\nexport function AuthProvider(\n  firebaseConfig: {},\n  options: RAFirebaseOptions\n): ReactAdminFirebaseAuthProvider {\n  VerifyAuthProviderArgs(firebaseConfig, options);\n  logger.SetEnabled(!!options?.logging);\n  const auth = new AuthClient(firebaseConfig, options);\n\n  const provider: ReactAdminFirebaseAuthProvider = {\n    // React Admin Interface\n    login: (params) => auth.HandleAuthLogin(params),\n    logout: () => auth.HandleAuthLogout(),\n    checkAuth: () => auth.HandleAuthCheck(),\n    checkError: (error) => auth.HandleAuthError(error),\n    getPermissions: () => auth.HandleGetPermissions(),\n    getIdentity: () => auth.HandleGetIdentity(),\n    // Custom Functions\n    getAuthUser: () => auth.getUserLogin(),\n    getJWTAuthTime: () => auth.HandleGetJWTAuthTime(),\n    getJWTExpirationTime: () => auth.HandleGetJWTExpirationTime(),\n    getJWTSignInProvider: () => auth.HandleGetJWTSignInProvider(),\n    getJWTClaims: () => auth.HandleGetPermissions(),\n    getJWTToken: () => auth.HandleGetJWTToken(),\n  };\n  return provider;\n}\n\nexport type ReactAdminFirebaseAuthProvider = RaAuthProvider & {\n  // Custom Functions\n  getAuthUser: () => Promise<FireUser>,\n  getJWTAuthTime: () => Promise<string | null>,\n  getJWTExpirationTime: () => Promise<string | null>,\n  getJWTSignInProvider: () => Promise<string | null>,\n  getJWTClaims: () => Promise<{ [key: string]: any; } | null>,\n  getJWTToken: () => Promise<string | null>,  \n}\n\nfunction VerifyAuthProviderArgs(\n  firebaseConfig: {},\n  options: RAFirebaseOptions\n) {\n  const hasNoApp = !options || !options.app;\n  const hasNoConfig = !firebaseConfig;\n  if (hasNoConfig && hasNoApp) {\n    throw new Error(\n      'Please pass the Firebase firebaseConfig object or options.app to the FirebaseAuthProvider'\n    );\n  }\n}\n","// From firebase SDK\n\nimport { logError } from \"./logger\";\n\n// - https://github.com/firebase/firebase-js-sdk/blob/9f109f85ad0d99f6c13e68dcb549a0b852e35a2a/packages/functions/src/api/error.ts\nexport function retrieveStatusTxt(status: number): 'ok' | 'unauthenticated' {\n  // Make sure any successful status is OK.\n  if (status >= 200 && status < 300) {\n    return 'ok';\n  }\n  switch (status) {\n    case 401: // 'unauthenticated'\n    case 403: // 'permission-denied'\n      return 'unauthenticated';\n\n    case 0: // 'internal'\n    case 400: // 'invalid-argument'\n    case 404: // 'not-found'\n    case 409: // 'aborted'\n    case 429: // 'resource-exhausted'\n    case 499: // 'cancelled'\n    case 500: // 'internal'\n    case 501: // 'unimplemented'\n    case 503: // 'unavailable'\n    case 504: // 'deadline-exceeded'\n    default:\n      // ignore\n      return 'ok';\n  }\n}\n\n// From firebase SDK\n// tslint:disable-next-line:max-line-length\n// - https://github.com/firebase/firebase-js-sdk/blob/9f109f85ad0d99f6c13e68dcb549a0b852e35a2a/packages/functions/src/api/error.ts\nexport function retrieveStatusCode(statusTxt: string): number {\n  // Make sure any successful status is OK.\n  const regexResult = /\\[code\\=([\\w-]*)/g.exec(statusTxt);\n  const status = Array.isArray(regexResult) && regexResult[1];\n  if (!status) {\n    logError('unknown StatusCode ', {statusTxt});\n  }\n  switch (status) {\n    case 'unauthenticated':\n      return 401;\n    case 'permission-denied':\n      return 403;\n    case 'internal':\n      return 0;\n    case 'invalid-argument':\n      return 400;\n    case 'not-found':\n      return 404;\n    case 'aborted':\n      return 409;\n    case 'resource-exhausted':\n      return 429;\n    case 'cancelled':\n      return 499;\n    case 'internal':\n      return 500;\n    case 'unimplemented':\n      return 501;\n    case 'unavailable':\n      return 503;\n    case 'deadline-exceeded':\n      return 504;\n    default:\n      return 200;\n  }\n}\n","import {\n  getAbsolutePath,\n  log,\n  logger,\n  retrieveStatusCode,\n  logError,\n  MakeFirestoreLogger,\n} from \"../misc\";\nimport * as ra from \"../misc/react-admin-models\";\nimport { RAFirebaseOptions } from \"./options\";\nimport { FirebaseWrapper } from \"./database/firebase/FirebaseWrapper\";\nimport { FireApp } from \"../misc/firebase-models\";\nimport { FireClient } from \"./database/FireClient\";\nimport { GetList, GetMany, GetManyReference, GetOne } from \"./queries\";\nimport { Create, Delete, DeleteMany, Update, UpdateMany } from \"./commands\";\n\nexport interface IDataProvider extends ra.DataProvider {\n  app: FireApp;\n}\n\nexport function DataProvider(\n  firebaseConfig: {},\n  optionsInput?: RAFirebaseOptions\n): IDataProvider {\n  const options = optionsInput || {};\n  verifyDataProviderArgs(firebaseConfig, options);\n\n  const flogger = MakeFirestoreLogger(options);\n  logger.SetEnabled(!!options?.logging);\n  flogger.SetEnabled(!!options?.firestoreCostsLogger?.enabled);\n  flogger.ResetCount(!options?.firestoreCostsLogger?.persistCount);\n  log('Creating FirebaseDataProvider', {\n    firebaseConfig,\n    options\n  });\n\n  const fireWrapper = new FirebaseWrapper(optionsInput, firebaseConfig);\n\n  async function run<T>(cb: () => Promise<T>) {\n    let res: any;\n    try {\n      res = await cb();\n      return res;\n    } catch (error) {\n      const errorMsg = ((error as any) || '').toString();\n      const code = retrieveStatusCode(errorMsg);\n      const errorObj = { status: code, message: errorMsg, json: res };\n      logError(\"DataProvider:\", error, { errorMsg, code, errorObj });\n      throw errorObj;\n    }\n  }\n  const client = new FireClient(fireWrapper, options, flogger);\n\n  const newProviderApi: IDataProvider = {\n    app: fireWrapper.GetApp(),\n    getList<RecordType extends ra.Record = ra.Record>(\n      resource: string,\n      params: ra.GetListParams\n    ): Promise<ra.GetListResult<RecordType>> {\n      return run(() => GetList<RecordType>(resource, params, client));\n    },\n    getOne<RecordType extends ra.Record = ra.Record>(\n      resource: string,\n      params: ra.GetOneParams\n    ): Promise<ra.GetOneResult<RecordType>> {\n      return run(() => GetOne<RecordType>(resource, params, client));\n    },\n    getMany<RecordType extends ra.Record = ra.Record>(\n      resource: string,\n      params: ra.GetManyParams\n    ): Promise<ra.GetManyResult<RecordType>> {\n      return run(() => GetMany<RecordType>(resource, params, client));\n    },\n    getManyReference<RecordType extends ra.Record = ra.Record>(\n      resource: string,\n      params: ra.GetManyReferenceParams\n    ): Promise<ra.GetManyReferenceResult<RecordType>> {\n      return run(() =>\n        GetManyReference<RecordType>(resource, params, client)\n      );\n    },\n    update<RecordType extends ra.Record = ra.Record>(\n      resource: string,\n      params: ra.UpdateParams\n    ): Promise<ra.UpdateResult<RecordType>> {\n      return run(() => Update<RecordType>(resource, params, client));\n    },\n    updateMany(\n      resource: string,\n      params: ra.UpdateManyParams\n    ): Promise<ra.UpdateManyResult> {\n      return run(() => UpdateMany(resource, params, client));\n    },\n    create<RecordType extends ra.Record = ra.Record>(\n      resource: string,\n      params: ra.CreateParams\n    ): Promise<ra.CreateResult<RecordType>> {\n      return run(() => Create<RecordType>(resource, params, client));\n    },\n    delete<RecordType extends ra.Record = ra.Record>(\n      resource: string,\n      params: ra.DeleteParams\n    ): Promise<ra.DeleteResult<RecordType>> {\n      return run(() => Delete(resource, params, client));\n    },\n    deleteMany(\n      resource: string,\n      params: ra.DeleteManyParams\n    ): Promise<ra.DeleteManyResult> {\n      return run(() => DeleteMany(resource, params, client));\n    },\n  };\n\n  return newProviderApi;\n}\n\nfunction verifyDataProviderArgs(\n  firebaseConfig: {},\n  options?: RAFirebaseOptions\n) {\n  const hasNoApp = !options || !options.app;\n  const hasNoConfig = !firebaseConfig;\n  if (hasNoConfig && hasNoApp) {\n    throw new Error(\n      'Please pass the Firebase firebaseConfig object or options.app to the FirebaseAuthProvider'\n    );\n  }\n  if (options && options.rootRef) {\n    // Will throw error if rootRef doesn't point to a document\n    getAbsolutePath(options.rootRef, 'test');\n  }\n}\n","import { FireClient } from '../database/FireClient';\nimport { FirebaseLazyLoadingClient } from '../lazy-loading/FirebaseLazyLoadingClient';\nimport {\n  filterArray,\n  log,\n  recursivelyMapStorageUrls,\n  sortArray,\n} from '../../misc';\nimport * as ra from '../../misc/react-admin-models';\n\nexport async function GetList<T extends ra.Record>(\n  resourceName: string,\n  params: ra.GetListParams,\n  client: FireClient\n): Promise<ra.GetListResult<T>> {\n  log('GetList', { resourceName, params });\n  const { rm, fireWrapper, options } = client;\n\n  if (options?.lazyLoading?.enabled) {\n    const lazyClient = new FirebaseLazyLoadingClient(\n      options,\n      rm,\n      client\n    );\n    return lazyClient.apiGetList<T>(resourceName, params);\n  }\n\n  const filterSafe = params.filter || {};\n\n  const collectionQuery = filterSafe.collectionQuery;\n  delete filterSafe.collectionQuery;\n\n  const r = await rm.TryGetResource(resourceName, 'REFRESH', collectionQuery);\n  const data = r.list;\n  if (params.sort != null) {\n    const { field, order } = params.sort;\n    if (order === 'ASC') {\n      sortArray(data, field, 'asc');\n    } else {\n      sortArray(data, field, 'desc');\n    }\n  }\n  let softDeleted = data;\n  if (options.softDelete && !Object.keys(filterSafe).includes('deleted')) {\n    softDeleted = data.filter((doc) => !doc.deleted);\n  }\n  const filteredData = filterArray(softDeleted, filterSafe);\n  const pageStart = (params.pagination.page - 1) * params.pagination.perPage;\n  const pageEnd = pageStart + params.pagination.perPage;\n  const dataPage = filteredData.slice(pageStart, pageEnd) as T[];\n  const total = filteredData.length;\n\n  if (options.relativeFilePaths) {\n    const data = await Promise.all(\n      dataPage.map((doc) => recursivelyMapStorageUrls(fireWrapper, doc))\n    );\n    return {\n      data,\n      total,\n    };\n  }\n\n  return {\n    data: dataPage,\n    total,\n  };\n}\n","import { FireClient } from '../database/FireClient';\nimport { log, translateDocFromFirestore } from '../../misc';\nimport * as ra from '../../misc/react-admin-models';\n\nexport async function GetOne<T extends ra.Record>(\n  resourceName: string,\n  params: ra.GetOneParams,\n  client: FireClient\n): Promise<ra.GetOneResult<T>> {\n  log(\"GetOne\", { resourceName, params });\n  const { rm } = client;\n  try {\n    const id = params.id + '';\n    const dataSingle = await rm.GetSingleDoc(resourceName, id);\n    client.flogger.logDocument(1)();\n    return { data: dataSingle as T };\n  } catch (error) {\n    throw new Error(\n      'Error getting id: ' + params.id + ' from collection: ' + resourceName\n    );\n  }\n}\n","import { FireClient } from '../database/FireClient';\nimport { log, recursivelyMapStorageUrls } from '../../misc';\nimport * as ra from '../../misc/react-admin-models';\n\nexport async function GetMany<T extends ra.Record>(\n  resourceName: string,\n  params: ra.GetManyParams,\n  client: FireClient\n): Promise<ra.GetManyResult<T>> {\n  const { rm, options, fireWrapper } = client;\n  const r = await rm.TryGetResource(resourceName);\n  const ids = params.ids;\n  log(\"GetMany\", { resourceName, resource: r, params, ids });\n  const matchDocSnaps = await Promise.all(\n    ids.map(idObj => {\n      if (typeof idObj === 'string') {\n        return r.collection.doc(idObj).get()\n      }\n      // Will get and resolve reference documents into the current doc\n      return r.collection.doc((idObj as any)['___refid']).get()\n    })\n  );\n  client.flogger.logDocument(ids.length)();\n  const matches = matchDocSnaps.map((snap) => {\n    return { ...snap.data(), id: snap.id } as T;\n  });\n  const permittedData = options.softDelete\n    ? matches.filter((row) => !row['deleted'])\n    : matches;\n  if (options.relativeFilePaths) {\n    const data = await Promise.all(\n      permittedData.map((doc) => recursivelyMapStorageUrls(fireWrapper, doc))\n    );\n    return {\n      data,\n    };\n  }\n\n  return {\n    data: permittedData,\n  };\n}\n","import { FireClient } from \"../database/FireClient\";\nimport { filterArray, log, recursivelyMapStorageUrls, sortArray } from \"../../misc\";\nimport * as ra from \"../../misc/react-admin-models\";\n\nexport async function GetManyReference<T extends ra.Record>(\n  resourceName: string,\n  params: ra.GetManyReferenceParams,\n  client: FireClient\n): Promise<ra.GetManyReferenceResult<T>> {\n  const { rm, options, fireWrapper } = client;\n  log(\"GetManyReference\", { resourceName, params });\n  const filterSafe = params.filter || {};\n  const collectionQuery = filterSafe.collectionQuery;\n  const r = await rm.TryGetResource(\n    resourceName,\n    \"REFRESH\",\n    collectionQuery\n  );\n  delete filterSafe.collectionQuery;\n  log(\"apiGetManyReference\", { resourceName, resource: r, params });\n  const data = r.list;\n  const targetField = params.target;\n  const targetValue = params.id;\n  let softDeleted = data;\n  if (options.softDelete) {\n    softDeleted = data.filter(doc => !doc['deleted'])\n  }\n  const filteredData = filterArray(softDeleted, filterSafe);\n  const targetIdFilter: Record<string, ra.Identifier> = {};\n  targetIdFilter[targetField] = targetValue;\n  const permittedData = filterArray(filteredData, targetIdFilter);\n  if (params.sort != null) {\n    const { field, order } = params.sort;\n    if (order === \"ASC\") {\n      sortArray(permittedData, field, \"asc\");\n    } else {\n      sortArray(permittedData, field, \"desc\");\n    }\n  }\n  const pageStart = (params.pagination.page - 1) * params.pagination.perPage;\n  const pageEnd = pageStart + params.pagination.perPage;\n  const dataPage = permittedData.slice(pageStart, pageEnd) as T[];\n  const total = permittedData.length;\n\n  if (options.relativeFilePaths) {\n    const data = await Promise.all(\n      permittedData.map((doc) =>\n        recursivelyMapStorageUrls(fireWrapper, doc)\n      )\n    );\n    return { data, total };\n  }\n\n  return { data: dataPage, total };\n}\n","import { FireClient } from \"../database/FireClient\";\nimport { log } from \"../../misc\";\nimport * as ra from \"../../misc/react-admin-models\";\n\nexport async function Update<T extends ra.Record>(\n  resourceName: string,\n  params: ra.UpdateParams,\n  client: FireClient\n): Promise<ra.UpdateResult<T>> {\n  const { rm } = client;\n  log(\"Update\", { resourceName, params });\n  const id = params.id + \"\";\n  delete params.data.id;\n  const r = await rm.TryGetResource(resourceName);\n  log(\"Update\", { resourceName, resource: r, params });\n  const data = await client.parseDataAndUpload(r, id, params.data);\n  const docObj = { ...data };\n  client.checkRemoveIdField(docObj, id);\n  await client.addUpdatedByFields(docObj);\n  const docObjTransformed = client.transformToDb(resourceName, docObj, id);\n  await r.collection.doc(id).update(docObjTransformed);\n  return {\n    data: {\n      ...data,\n      id: id,\n    },\n  };\n}\n","import { FireClient } from \"../database/FireClient\";\nimport { log } from \"../../misc\";\nimport * as ra from \"../../misc/react-admin-models\";\n\nexport async function UpdateMany(\n  resourceName: string,\n  params: ra.UpdateManyParams,\n  client: FireClient\n): Promise<ra.UpdateManyResult> {\n  const { rm } = client;\n  log(\"UpdateMany\", { resourceName, params });\n  delete params.data.id;\n  const r = await rm.TryGetResource(resourceName);\n  log(\"UpdateMany\", { resourceName, resource: r, params });\n  const ids = params.ids;\n  const returnData = await Promise.all(\n    ids.map(async id => {\n      const idStr = id+'';\n      const data = await client.parseDataAndUpload(r, idStr, params.data);\n      const docObj = { ...data };\n      client.checkRemoveIdField(docObj, idStr);\n      await client.addUpdatedByFields(docObj);\n      const docObjTransformed = client.transformToDb(resourceName, docObj, idStr);\n      await r.collection\n        .doc(idStr)\n        .update(docObjTransformed);\n      return {\n        ...data,\n        id: idStr\n      };\n    })\n  );\n  return {\n    data: returnData\n  };\n}\n","import { FireClient } from \"../database/FireClient\";\nimport { log } from \"../../misc\";\nimport * as ra from \"../../misc/react-admin-models\";\n\nexport async function Create<T extends ra.Record>(\n  resourceName: string,\n  params: ra.CreateParams,\n  client: FireClient\n): Promise<ra.CreateResult<T>> {\n  const { rm, fireWrapper } = client;\n  const r = await rm.TryGetResource(resourceName);\n  log(\"Create\", { resourceName, resource: r, params });\n  const hasOverridenDocId = params.data && params.data.id;\n  log(\"Create\", { hasOverridenDocId });\n  if (hasOverridenDocId) {\n    const overridenId = params.data.id;\n    const exists = (await r.collection.doc(overridenId).get()).exists;\n    if (exists) {\n      throw new Error(\n        `the id:\"${overridenId}\" already exists, please use a unique string if overriding the 'id' field`\n      );\n    }\n    const data = await client.parseDataAndUpload(r, overridenId, params.data);\n    if (!overridenId) {\n      throw new Error(\"id must be a valid string\");\n    }\n    const docObj = { ...data };\n    client.checkRemoveIdField(docObj, overridenId);\n    await client.addCreatedByFields(docObj);\n    await client.addUpdatedByFields(docObj);\n    const docObjTransformed = client.transformToDb(resourceName, docObj, overridenId);\n    log(\"Create\", { docObj });\n    await r.collection.doc(overridenId).set(docObjTransformed, { merge: false });\n    return {\n      data: {\n        ...docObjTransformed,\n        id: overridenId,\n      },\n    };\n  }\n  const newId = fireWrapper.dbMakeNewId();\n  const data = await client.parseDataAndUpload(r, newId, params.data);\n  const docObj = { ...data };\n  client.checkRemoveIdField(docObj, newId);\n  await client.addCreatedByFields(docObj);\n  await client.addUpdatedByFields(docObj);\n  const docObjTransformed = client.transformToDb(resourceName, docObj, newId);\n  await r.collection.doc(newId).set(docObjTransformed, { merge: false });\n  return {\n    data: {\n      ...docObjTransformed,\n      id: newId,\n    },\n  };\n}\n","import { FireClient } from \"../database/FireClient\";\nimport { log } from \"../../misc\";\nimport * as ra from \"../../misc/react-admin-models\";\nimport { DeleteSoft } from \"./Delete.Soft\";\n\nexport async function Delete<T extends ra.Record>(\n  resourceName: string,\n  params: ra.DeleteParams,\n  client: FireClient\n): Promise<ra.DeleteResult<T>> {\n  const { rm, options } = client;\n  if (options.softDelete) {\n    return DeleteSoft(resourceName, params, client);\n  }\n  const r = await rm.TryGetResource(resourceName);\n  log(\"apiDelete\", { resourceName, resource: r, params });\n  try {\n    const id = params.id + \"\";\n    await r.collection.doc(id).delete();\n  } catch (error) {\n    throw new Error(error as any);\n  }\n  return {\n    data: params.previousData as T,\n  };\n}\n","import { FireClient } from \"../database/FireClient\";\nimport { log, logError } from \"../../misc\";\nimport * as ra from \"../../misc/react-admin-models\";\n\nexport async function DeleteSoft<T extends ra.Record>(\n  resourceName: string,\n  params: ra.DeleteParams,\n  client: FireClient\n): Promise<ra.DeleteResult<T>> {\n  const { rm } = client;\n  const id = params.id + \"\";\n  const r = await rm.TryGetResource(resourceName);\n  log(\"DeleteSoft\", { resourceName, resource: r, params });\n  const docObj = { deleted: true };\n  await client.addUpdatedByFields(docObj);\n  r.collection\n    .doc(id)\n    .update(docObj)\n    .catch((error) => {\n      logError(\"DeleteSoft error\", { error });\n    });\n  return {\n    data: params.previousData as T,\n  };\n}\n","import { FireClient } from \"../database/FireClient\";\nimport { log } from \"../../misc\";\nimport * as ra from \"../../misc/react-admin-models\";\nimport { DeleteManySoft } from \"./DeleteMany.Soft\";\n\nexport async function DeleteMany(\n  resourceName: string,\n  params: ra.DeleteManyParams,\n  client: FireClient\n): Promise<ra.DeleteManyResult> {\n  const { options, rm, fireWrapper } = client;\n  if (options.softDelete) {\n    return DeleteManySoft(resourceName, params, client);\n  }\n  const r = await rm.TryGetResource(resourceName);\n  log(\"DeleteMany\", { resourceName, resource: r, params });\n  const returnData: ra.Identifier[] = [];\n  const batch = fireWrapper.dbCreateBatch();\n  for (const id of params.ids) {\n    const idStr = id + '';\n    const docToDelete = r.collection.doc(idStr);\n    batch.delete(docToDelete);\n    returnData.push(id);\n  }\n  try {\n    await batch.commit();\n  } catch (error) {\n    throw new Error(error as any)\n  }\n  return { data: returnData };\n}\n","import { FireClient } from \"../database/FireClient\";\nimport { log, logError } from \"../../misc\";\nimport * as ra from \"../../misc/react-admin-models\";\n\nexport async function DeleteManySoft(\n  resourceName: string,\n  params: ra.DeleteManyParams,\n  client: FireClient\n): Promise<ra.DeleteManyResult> {\n  const { rm } = client;\n  const r = await rm.TryGetResource(resourceName);\n  log(\"DeleteManySoft\", { resourceName, resource: r, params });\n  const ids = params.ids;\n  const returnData = await Promise.all(\n    ids.map(async (id) => {\n      const idStr = id + \"\";\n      const docObj = { deleted: true };\n      await client.addUpdatedByFields(docObj);\n      r.collection\n        .doc(idStr)\n        .update(docObj)\n        .catch((error) => {\n          logError(\"apiSoftDeleteMany error\", { error });\n        });\n      return idStr;\n    })\n  );\n  return {\n    data: returnData,\n  };\n}\n"],"names":["data","field","dir","sort","a","b","get","rawB","isAsc","Number","isFinite","rawA","basicSort","toLowerCase","Date","aValue","bValue","filterArray","searchFields","isEmpty","searchObjs","Object","keys","map","fieldName","getSubObjects","value","searchField","searchValue","tree","leaves","obj","path","key","hasOwnProperty","objVal","Array","recursivelyWalk","currentPath","push","getFieldReferences","apply","filter","row","reduce","acc","cur","res","doesRowMatch","searchThis","toString","includes","isArray","LogNoOp","LoggerBase","title","cacheEnabledKey","this","_proto","prototype","isEnabled","localStorage","getItem","SetEnabled","setItem","removeItem","console","log","bind","warn","error","logger","logError","KEY_SINGLE","dispatch","eventName","fileName","eventMonitor","document","getElementById","event","CustomEvent","detail","dispatchEvent","result","parsedDoc","refdocs","recusivelyCheckObjectValue","input","fieldPath","toDate","index","isInputADocReference","refDocPath","ref","id","firestore","parent","recursivelyMapStorageUrls","fireWrapper","fieldValue","_exit2","_temp3","_result","Promise","all","_recursivelyMapStorag","e","reject","then","resolve","_recursivelyMapStorag2","isFileField","has","_temp4","storage","src","getDownloadURL","_catch","parseFireStoreDocument","doc","logWarn","translateDocFromFirestore","refDocs","d","set","applyRefDocs","dataWithRefs","getAbsolutePath","rootRef","relativePath","Error","rootRefValue","withSlashes","join","split","length","slice","joinPaths","call","arguments","translateDocToFirestore","uploads","recusivelyParseObjectValue","fieldDotsPath","refPath","fieldSlashesPath","rawFile","FirebaseWrapper","inputOptions","firebaseConfig","app","options","optionsSafe","window","_firebase$apps","firebase","apps","initializeApp","ObtainFirebaseApp","dbGetCollection","absolutePath","collection","dbCreateBatch","batch","dbMakeNewId","OnUserLogout","callBack","auth","onAuthStateChanged","user","isLoggedOut","putFile","storagePath","task","put","taskResult","rej","downloadUrl","t","url","getStorageDownloadUrl","fieldSrc","serverTimestamp","FieldValue","authSetPersistence","persistenceInput","persistenceResolved","Auth","Persistence","LOCAL","NONE","SESSION","setPersistence","authSigninEmailPassword","email","password","signInWithEmailAndPassword","authSignOut","signOut","authGetUserLoggedIn","_this10","currentUser","unsubscribe","GetUserLogin","GetApp","db","TASK_PAUSED","TaskState","PAUSED","TASK_RUNNING","RUNNING","TASK_CANCELED","CANCELED","ResourceManager","flogger","_this","resources","TryGetResource","resourceName","refresh","collectionQuery","_this3","TryGetResourcePromise","RefreshResource","GetResource","resource","_this5","initPath","_this7$options","_this7$options$lazyLo","_this7","lazyLoading","enabled","query","applyQuery","newDocs","list","docs","logDocument","collectionPath","GetSingleDoc","docId","_this9","docSnap","exists","_this11","hasBeenInited","pathAbsolute","allResources","getUserIdentifier","_this13","associateUsersById","getCurrentUserId","getCurrentUserEmail","uid","collRef","FireClient","rm","checkRemoveIdField","dontAddIdFieldToDoc","transformToDb","documentData","parseDataAndUpload","r","_this2","u","parseStoragePath","docPath","useFileName","fileNameBits","File","name","fileExtension","pop","useFileNamesInStorage","saveFile","link","addCreatedByFields","_this4","AddCreatedByFields","disableMeta","currentUserIdentifier","createAtSelector","GetSelectorsCreateAt","renameMetaFields","created_at","casing","metaFieldCasing","defautCase","createBySelector","GetSelectorsCreateBy","created_by","addUpdatedByFields","_this6","AddUpdatedByFields","updateAtSelector","GetSelectorsUpdateAt","updated_at","updateBySelector","updated_by","GetSelectorsUpdateBy","_this8","_this8$fireWrapper$pu","on","snapshot","progress","bytesTransferred","totalBytes","state","_ref","relativeFilePaths","storageError","_settle","pact","s","_Pact","o","v","observer","onFulfilled","onRejected","callback","_isSettledPact","thenable","findLastQueryCursor","getQueryCursor","params","btoa","JSON","stringify","paramsToQuery","defaultParamsToQueryOptions","filtersStepQuery","filters","entries","opStr","where","sortStepQuery","sortToQuery","order","toLocaleLowerCase","orderBy","parsedOrder","pagination","_params$pagination","page","perPage","queryCursor","startAfter","limit","_temp","queryBase","currentPage","newQuery","startAt","lastQueryCursor","snapshots","docsLength","currentPageParams","_extends","_for","_getQueryCursor","_findLastQueryCursor","paginationToQuery","getFullParamsForQuery","reactAdminParams","softdeleteEnabled","deleted","array","body","check","i","_cycle","FirebaseLazyLoadingClient","client","apiGetList","tryGetResource","softDelete","resultsCount","message","total","nextPageCursor","setQueryCursor","allCursorsKey","localCursorKeys","newCursors","parse","concat","getNextPageParams","checkIfOnLastPage","isOnLastPage","_forIn","parsedData","_exit","_temp2","apiGetManyReference","filterWithTarget","_extends2","target","_temp5","_temp8","_temp6","nextElementSnapshot","empty","clearQueryCursors","forEach","cursor","AuthClient","optionsInput","persistence","HandleAuthLogin","username","getUserLogin","HandleAuthLogout","HandleAuthError","errorHttp","retrieveStatusTxt","status","HandleAuthCheck","HandleGetPermissions","getIdTokenResult","token","claims","HandleGetIdentity","displayName","photoURL","fullName","avatar","HandleGetJWTAuthTime","authTime","HandleGetJWTExpirationTime","_this12","expirationTime","HandleGetJWTSignInProvider","_this14","signInProvider","HandleGetJWTIssuedAtTime","_this16","issuedAtTime","HandleGetJWTToken","_this18","AuthProvider","VerifyAuthProviderArgs","logging","login","logout","checkAuth","checkError","getPermissions","getIdentity","getAuthUser","getJWTAuthTime","getJWTExpirationTime","getJWTSignInProvider","getJWTClaims","getJWTToken","run","cb","_cb","errorMsg","code","statusTxt","regexResult","exec","retrieveStatusCode","errorObj","json","verifyDataProviderArgs","MakeFirestoreLogger","ResetCount","shouldReset","docCount","_options$lazyLoading","count","incrementBy","parseInt","currentCountRaw","incremented","incrementRead","_options$firestoreCos","firestoreCostsLogger","_options$firestoreCos2","persistCount","newProviderApi","getList","lazyClient","filterSafe","dataPage","sortArray","_params$sort","softDeleted","filteredData","pageStart","GetList","getOne","GetOne","dataSingle","getMany","GetMany","ids","idObj","matchDocSnaps","permittedData","matches","snap","getManyReference","targetField","targetValue","targetIdFilter","GetManyReference","update","Update","docObj","docObjTransformed","updateMany","UpdateMany","idStr","returnData","create","Create","newId","merge","hasOverridenDocId","overridenId","_r$collection$doc$get","delete","Delete","previousData","DeleteSoft","deleteMany","DeleteManySoft","_step","_iterator","done","docToDelete","commit","DeleteMany"],"mappings":"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"}